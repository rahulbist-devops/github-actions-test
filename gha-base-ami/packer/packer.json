{
    "variables": {
        "aws_region": "us-east-1",
        "subnet_id": "subnet-07bdb7f564a1ed87e",
        "ami_owner_account": "099720109477",
        "aws_access_key": "{{env `AWS_ACCESS_KEY_ID`}}",
        "aws_secret_key": "{{env `AWS_SECRET_ACCESS_KEY`}}",
        "aws_session_token": "{{env `AWS_SESSION_TOKEN`}}"
    },
    "builders": [
      {
        "type": "amazon-ebs",
        "access_key": "{{user `aws_access_key`}}",
        "secret_key": "{{user `aws_secret_key`}}",
        "token": "{{user `aws_session_token`}}",
        "ami_name": "gha_custom_runner_Base_linux_ami_{{ timestamp }}",
        "ami_description": "Bain GitHub Actions Custom Runner Ubuntu Server 20.04 LTS (HVM),EBS General Purpose (SSD) Volume Type AMI",
        "region": "{{user `aws_region`}}",
        "instance_type": "t2.small",
        "ssh_username": "ubuntu",
        "ssh_timeout": "10m",
        "ssh_pty": true,
        "subnet_id": "{{user `subnet_id`}}",
        "tags": {
          "OS": "Ubuntu Server 20.04 LTS (HVM),EBS General Purpose (SSD) Volume Type",
          "Build_version": "{{ timestamp }}"
        },
        "source_ami_filter": {
          "filters": {
          "virtualization-type": "hvm",
          "name": "ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*",       
          "root-device-type": "ebs"
          },
          "owners": "{{user `ami_owner_account`}}",
          "most_recent": true
       }
      }
    ],
    "provisioners": [
      {
        "type": "shell",
        "inline": [
            "sudo apt-add-repository -y ppa:ansible/ansible",
            "sudo apt-get update",
            "sudo apt-get -y install ansible"
        ],
        "inline_shebang": "/bin/sh -x"
      },
      {
        "type": "ansible-local",
        "playbook_file": "./playbook.yml"
      }
    ]
  }
